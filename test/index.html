<!DOCTYPE html><html><head><title>Joker test</title>
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta charset="utf-8"></head><body>

<!--
<script src="../lib/WebModule.js"></script>
<script src="../lib/Joker.js"></script>
<script src="../node_modules/uupaa.spec.js/lib/SpecCatalog.js"></script>
<script src="../node_modules/uupaa.spec.js/lib/Spec.js"></script>
<script src="../node_modules/uupaa.hash.js/lib/Hash.js"></script>
 -->
<!--
<script type="text/foo">
Foo Foo Foo-
</script>
 -->

<script>
/*
function detect() {
    var spec  = new WebModule.Spec();
    var joker = new WebModule.Joker(spec);
    var Hash  = WebModule.Hash;

    var result = {
        "Model":          spec.DEVICE,
        "Adler32:      ": joker.getFingerprint("Canvas", Hash.Adler32),
        "Adler32(Hex): ": "0x" + Hash.toHexString(joker.getFingerprint("Canvas", Hash.Adler32)),
        "XXHash:       ": joker.getFingerprint("Canvas", Hash.XXHash),
        "XXHash(Hex):  ": "0x" + Hash.toHexString(joker.getFingerprint("Canvas", Hash.XXHash)),
    };
    console.log(JSON.stringify(result, null, 2));
    alert(JSON.stringify(result, null, 2));
}

window.onload = detect;
 */

    var canvas = document.createElement("canvas");

    canvas.style.cssText = "border:1px solid red";

    if (canvas) {
        canvas.width = 160;
        canvas.height = 16;

            document.body.appendChild(canvas);

            // https://www.browserleaks.com/canvas#how-does-it-work
            var ctx = canvas.getContext("2d");
            var txt = "https://github.com/uupaa/";
            //var txt = new Date() + "";

        //var a = performance.now();
        var a = Date.now();
            ctx.textBaseline = "top";
            ctx.font = "13px 'Arial'";
            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125,1,34,14);
            ctx.fillStyle = "#069";
            ctx.fillText(txt, 0, 12);
            ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
            ctx.fillText(txt, 2, 14);
        var b = Date.now();


            var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var pixelData = new Uint8Array(imageData.data.buffer);
        var c = Date.now();

        var hash = _hash(pixelData);
        var d = Date.now();

        //var b = performance.now();

        alert(JSON.stringify({ total: d - a, render: b - a, getImageData: c - b, hash: d - c }));
      alert(hash);

    }



function _hash(source) {
    var u32 = new Uint32Array([1, 0, source.length, 0, 0, 65521, 5550, 0]);

    while (u32[2] > 0) {
        u32[4] = u32[2] > u32[6] ? u32[6] : u32[2];
        u32[2] -= u32[4];

        do {
            u32[0] += source[u32[3]++];
            u32[1] += u32[0];
        } while (--u32[4]);

        u32[0] %= u32[5];
        u32[1] %= u32[5];
    }
    return ((u32[1] << 16) | u32[0]) >>> 0;
};


</script>

</body></html>


